# Side-door

> "Stand by the grey stone when the thrush knocks, and the setting sun with the last light of Durin's Day will shine upon the key-hole."
> --Thorin, _The Hobbit_, J. R. R. Tolkien

> "Keep it secret, keep it safe.
> --Gandalf, _The Fellowship of the Ring_, J. R. R. Tolkien

Side-door is an HTTP authentication API server written in Go. Complete with its own key-value store, it handles storing hashed user credentials and tokens.

Don't let hackers in through a back door. Use Side-door. :)

# API

Side-door generates a unique key during each startup.
```bash
$ go run sidedoor.go
2022/08/31 05:01:58 Side-door key: 818e28874c434e57e70828803d37900dd8a5412f
```

All requests to Side-door require the `Authorization` HTTP header to be set to this key.
```
SIDE_DOOR=818e28874c434e57e70828803d37900dd8a5412f
curl -H "Authorization: $SIDE_DOOR" ...
```

## New
> Create a new user, and store their hashed password in the `users` table.

`/api/v1/new`

#### Example
```javascript
curl -H "Authorization: $SIDE_DOOR" -d '{"username":"frodo","password":"baggins"}' -X POST localhost/api/v1/new
```
##### Success
```javascript
{"username":"frodo"}
```
##### Error
```javascript
{"error":"Username is invalid or already taken"}
```


## Auth
> Authenticate a user, and store the newly generated token in the `tokens` table, hashed, of course.

`/api/v1/auth`

#### Example
```javascript
curl -H "Authorization: $SIDE_DOOR" -d '{"username":"frodo","password":"baggins"}' -X POST localhost/api/v1/auth
```
##### Success
```javascript
{"username":"frodo","token":"598a5593-b2b9-4426-84b8-dce4d5cd9996"}
```
##### Error
```javascript
{"error":"Authentication failed"}
```


## Edit
> Change a user's password. This requires a token previously generated by a sucessful auth request.

`/api/v1/edit`

#### Example
```javascript
curl -H "Authorization: $SIDE_DOOR" -d '{"username":"frodo","password":"Abcd1234","token":"598a5593-b2b9-4426-84b8-dce4d5cd9996"}' -X POST localhost/api/v1/edit
```
##### Success
```javascript
{"username":"frodo"}
```
##### Error
```javascript
{"error":"Invalid username or token"}
```

## Delete
> Delete a user. This requires a token previously generated by a successful auth request.

`/api/v1/delete`

#### Example
```javascript
curl -H "Authorization: $SIDE_DOOR" -d '{"username":"frodo","token":"598a5593-b2b9-4426-84b8-dce4d5cd9996"}' -X POST localhost/api/v1/delete
```
##### Success
```javascript
{"username":"frodo"}
```
##### Error
```javascript
{"error":"Invalid username or token"}
```
